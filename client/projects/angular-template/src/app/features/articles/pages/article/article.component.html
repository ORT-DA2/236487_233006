<article class="private-page-container" *ngIf="vm$ | async as vm">
  <ng-container *ngIf="vm.article">
    <ng-container *ngIf="!vm.article.isRejected; else articleRejectedTemplate">
      <article-header
        [article]="vm.article"
        [author]="vm.author!"
        [canApproveReject]="this.isAdmin(vm.loggedUser!)"
        [isLoggedUserAuthor]="isLoggedUserAuthor(vm.loggedUser!, vm.article)"
        (articleApproved)="onArticleApprove($event)"
        (articleRejected)="onArticleReject($event)"
      />

      <article-body
        [article]="vm.article"
        [words$]="words$"
      />

      <add-comment
        *ngIf="vm.article.isApproved"
        [article]="vm.article"
        [data$]="data$"
        [structure$]="structure$"
        [isLoggedUserAuthor]="isLoggedUserAuthor(vm.loggedUser!, vm.article)"
        (addComment)="submit($event)"
        (updateForm)="updateForm($event)"
      />

      <ng-container *ngFor="let comment of vm.article.comments">
        <comment-list-item
          *ngIf="comment.isApproved || this.isAdmin(vm.loggedUser!)"
          [comment]="comment"
          [words$]="words$"
          [canReply]="isLoggedUserAuthor(vm.loggedUser!, vm.article)"
          [canApproveAndReject]="this.isAdmin(vm.loggedUser!)"
          [openedReplyBox$]="openedReplyBox$"
          (commentApproved)="onCommentApprove($event, vm.article.id)"
          (commentRejected)="onCommentReject($event, vm.article.id)"
          (commentReplied)="onCommentReply($event, vm.article.id)"
          (openedReplyBox)="onReplyBoxOpened($event)"
          (closedReplyBox)="onReplyBoxClosed()"
        />
      </ng-container>
    </ng-container>

    <ng-template #articleRejectedTemplate>
      <div class="flex flex-column justify-content-center">
        <h1 class="underline text-red-500">Article rejected</h1>
        <a
          pRipple
          class="align-self-center cursor-pointer text-center h-full inline-flex align-items-center text-600 hover:border-500 transition-colors transition-duration-150 py-3 lg:py-0 px-3 no-underline"
          [routerLink]="'/private/articles'"
          routerLinkActive="border-blue-500"
          [routerLinkActiveOptions]="{ exact: true }"
        >
          <span class="pi pi-home mr-2"></span>
          <span class="font-medium">Go home</span>
        </a>
      </div>
    </ng-template>


    <loading *ngIf="vm.loading" />
  </ng-container>
</article>
